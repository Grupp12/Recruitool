package view;

import controller.Controller;
import javax.inject.Named;
import javax.enterprise.context.SessionScoped;
import java.io.Serializable;
import javax.ejb.EJB;
import integration.EntityExistsException;

/**
 * View class to be used by JSF. Handles basic view logic and calls the 
 * controller to perform application operations.
 */
@Named("myView")
@SessionScoped
public class View implements Serializable {
	@EJB
	private Controller controller;
	
	private RegisterForm registerForm = new RegisterForm();
	
	private String formMessage;
	
	/**
	 * Returns the object representing the register form.
	 * 
	 * @return the register form object.
	 */
	public RegisterForm getRegisterForm() {
		return registerForm;
	}
	
	/**
	 * Registers a new account with the data currently in the register form.
	 */
	public String register() {
		String result = "";
		formMessage = null;
		try {
			controller.register(registerForm);
			
			// Reset the form
			registerForm = new RegisterForm();
			
			formMessage = "Your account has been created!";
		} catch (Throwable ex) {
			result = handleException(ex);
		}
		return result;
	}
	
	private String handleException (Throwable ex) {
		String errorMessage = "";
		if(ex instanceof EntityExistsException) {
			formMessage = ex.getMessage();
		}
		else {
			errorMessage = "unhandledError";
		}
		
		return errorMessage;
	}
	
	/**
	 * Returns the latest message generated by the input form.
	 * 
	 * @return the registration message.
	 */
	public String getFormMessage() {
		return formMessage;
	}
}
